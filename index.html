<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Ulang Tahun Juju Junior</title>
    
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts for custom typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;700&family=Dancing+Script&family=Lobster&family=Pacifico&family=Caveat&family=Satisfy&family=Courgette&family=Permanent+Marker&family=Roboto+Slab&family=Fugaz+One&display=swap" rel="stylesheet">

    <style>
        /* A custom font family from Google Fonts for a more elegant look */
        .font-great-vibes {
            font-family: 'Great Vibes', cursive;
        }

        /* Set base styles for the entire page to handle scrolling and fonts */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevents both vertical and horizontal default scrolling */
            height: 100%;
            width: 100%;
            font-family: 'Poppins', sans-serif;
            background-color: #f4f1eb; /* A soft, warm background color */
        }

        /* Styles for the initial cover page, which acts as a splash screen */
        #cover {
            position: fixed; /* Mengunci posisi cover agar selalu di atas viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 100; /* Ensures the cover page is on top of everything */
            transition: opacity 0.8s ease-in-out; /* Smooth fade-out effect */
            color: white;
        }

        /* A semi-transparent overlay to make the text more readable on the background image */
        .cover-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 2rem;
            border-radius: 1rem;
            backdrop-filter: blur(5px);
            /* Applying a simple animation to the overlay */
            animation: pulse 2s infinite ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* CSS Keyframes for the looping pulse animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Main container for the invitation content, designed for horizontal and vertical scrolling */
        #main-content {
            display: flex;
            width: 100%;
            height: 100%;
            overflow-x: scroll; /* Enables horizontal scrolling */
            overflow-y: scroll; /* Enables vertical scrolling for long content */
            scroll-snap-type: x mandatory; /* Snaps to each section for a smooth, page-like experience */
            -webkit-overflow-scrolling: touch; /* Improves scrolling performance on iOS devices */
        }

        /* Each section wrapper occupies the full viewport and handles the snap and fade-in animations */
        .section-wrapper {
            width: 100vw;
            min-height: 100vh; /* Changed from height to min-height to allow vertical scrolling */
            flex-shrink: 0; /* Prevents sections from shrinking */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
            scroll-snap-align: start; /* Snaps the start of the section to the start of the scroll container */
            opacity: 0; /* Initial state for the fade-in animation */
            transform: translateY(20px);
            transition: opacity 1s ease-out, transform 1s ease-out; /* Smooth transition for the fade-in effect */
        }
        
        /* The state when the section becomes visible, triggering the fade-in animation */
        .section-wrapper.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Styles for the card-like container within each section */
        .section-card {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            color: #4a4a4a;
            white-space: normal;
        }
        
        /* Styles for the countdown timer's individual boxes */
        .countdown-box {
            background: #4a4a4a;
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* General styles for the new buttons and menus on the cover page */
        .floating-btn {
            position: absolute;
            top: 2rem;
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 9999px;
            cursor: pointer;
            z-index: 101;
        }

        .menu-container {
            position: absolute;
            top: 6rem;
            right: 1.5rem;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 102;
            max-height: 70vh;
            overflow-y: auto;
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            text-align: left;
        }

        /* Styles for the guest link generator box */
        #link-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 110;
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        /* Styles for the new guest display box */
        #guest-display-box {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 1.5rem;
            border-radius: 1rem;
            margin-top: 2rem; /* Adjusted margin for new position */
            backdrop-filter: blur(10px);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
    </style>
</head>
<body>

    <!-- Cover Page - The first page the user sees -->
    <div id="cover">
        <!-- New buttons for music, font, link, and background options -->
        <button id="music-btn" class="floating-btn right-2 sm:right-4">
            <!-- Music icon (SVG from Feather Icons) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
            </svg>
        </button>

        <button id="font-btn" class="floating-btn right-12 sm:right-16">
            <!-- Font icon (SVG from Feather Icons) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="4 7 4 4 20 4 20 7"></polyline>
                <line x1="9" y1="20" x2="15" y2="20"></line>
                <line x1="12" y1="4" x2="12" y2="20"></line>
            </svg>
        </button>

        <button id="link-gen-btn" class="floating-btn right-24 sm:right-28">
            <!-- Link icon (SVG from Feather Icons) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
        </button>

        <button id="bg-btn" class="floating-btn right-36 sm:right-40">
            <!-- Background icon (SVG from Feather Icons) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 21.6c-4.4-4.5-8-8.3-8-12.7A8 8 0 1 1 12 2a8 8 0 0 1 8 8c0 4.4-3.6 8.2-8 12.7z"></path>
                <path d="M12 10.2v11.4"></path>
                <circle cx="12" cy="10" r="3"></circle>
                <path d="M12 10.2c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z"></path>
            </svg>
        </button>

        <!-- Font selector menu -->
        <div id="font-menu" class="menu-container text-black">
            <h4 class="font-bold text-lg mb-2 text-center text-amber-800">Pilih Font & Warna</h4>
            <div id="font-options" class="flex flex-col gap-2 mb-4">
                <!-- Font buttons will be generated here by JavaScript -->
            </div>
            <label for="font-color" class="block mb-2 text-sm text-center">Pilih Warna Font:</label>
            <input type="color" id="font-color" value="#4a4a4a" class="w-full h-8 rounded-lg cursor-pointer">
        </div>

        <!-- Background options menu -->
        <div id="bg-menu" class="menu-container text-black">
            <h4 class="font-bold text-lg mb-2 text-center text-amber-800">Pilih Latar Belakang</h4>
            <div class="flex flex-col gap-4">
                <!-- Image Option -->
                <div>
                    <h5 class="font-semibold text-sm mb-1">Gambar Rekomendasi</h5>
                    <div id="bg-image-options" class="grid grid-cols-2 gap-2">
                        <!-- Image buttons will be generated by JavaScript -->
                    </div>
                </div>
                <!-- Solid Color Option -->
                <div>
                    <h5 class="font-semibold text-sm mb-1">Warna Solid</h5>
                    <input type="color" id="bg-solid-color" value="#F4F1EB" class="w-full h-8 rounded-lg cursor-pointer">
                </div>
                <!-- Gradient Option -->
                <div>
                    <h5 class="font-semibold text-sm mb-1">Warna Gradien</h5>
                    <div class="flex flex-col gap-2">
                        <label class="text-xs">Warna Awal:</label>
                        <input type="color" id="bg-grad-color1" value="#FFDD55" class="w-full h-8 rounded-lg cursor-pointer">
                        <label class="text-xs">Warna Akhir:</label>
                        <input type="color" id="bg-grad-color2" value="#FF8800" class="w-full h-8 rounded-lg cursor-pointer">
                        <button id="apply-bg-gradient-btn" class="w-full bg-amber-800 text-white px-4 py-2 rounded-full text-sm hover:bg-amber-900">Terapkan Gradien</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guest link generator box -->
        <div id="link-box" class="text-black">
            <h4 class="font-bold text-lg mb-4 text-amber-800">Buat Link Tamu</h4>
            <p class="text-sm mb-2">Masukkan nama tamu yang ingin diundang:</p>
            <input type="text" id="guest-name-input" placeholder="Nama Tamu" class="w-full px-4 py-2 mb-4 border rounded-md">
            <button id="generate-link-btn" class="bg-amber-800 text-white px-6 py-2 rounded-full hover:bg-amber-900 transition duration-300 shadow-md">
                Generate Link
            </button>
            <div id="generated-link-area" class="mt-4 w-full">
                <!-- Generated link and copy button will appear here -->
            </div>
            <button id="close-link-box" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <div class="cover-overlay flex-col space-y-4">
            <p id="cover-title" class="text-xl md:text-2xl">Undangan Syukuran Ulang Tahun</p>
            <h1 id="child-name" class="font-great-vibes text-6xl md:text-9xl my-4">Juju Junior</h1>
            
            <button id="open-button" class="bg-amber-800 text-white px-8 py-3 rounded-full hover:bg-amber-900 transition duration-300 shadow-lg text-lg">
                Buka Undangan
            </button>

            <!-- New guest greeting box, initially hidden -->
            <div id="guest-display-box" class="hidden text-white">
                <p class="text-lg md:text-xl">Yang terhormat Bpk/Ibu/Sdr/i</p>
                <p id="guest-name" class="font-bold text-2xl md:text-3xl mt-2"></p>
                <p id="apology-text" class="text-xs opacity-70 mt-4">Mohon maaf jika ada kesalahan penulisan nama / gelar</p>
            </div>
        </div>
    </div>

    <!-- Main Content with Horizontal Scroll -->
    <main id="main-content" class="hidden">
        <!-- Section 1: Opening Message -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-6 text-amber-800">Assalamu'alaikum Wr. Wb.</h2>
                <p class="mb-4">Dengan memohon rahmat dan ridho Allah SWT, kami mengundang Bapak/Ibu/Saudara/i untuk hadir dalam acara syukuran ulang tahun putra kami:</p>
                <h3 class="font-great-vibes text-6xl my-6 text-amber-900">Juju Junior</h3>
                <p>Kehadiran dan doa restu Anda adalah kebahagiaan bagi kami.</p>
            </div>
        </section>

        <!-- Section 2: Prayer & Hope -->
        <section class="section-wrapper">
            <div class="section-card">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-amber-800"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12.5 15.5c-1.5-1-1.5-3-0-4 1.5-1 1.5-3 0-4"></path><path d="M8.5 15.5c1.5-1 1.5-3 0-4-1.5-1-1.5-3 0-4"></path></svg>
                <h2 class="text-3xl font-bold mb-4 text-amber-900">Doa & Harapan</h2>
                <p class="text-md italic">"Ya Allah, panjangkanlah umurnya, sehatkanlah jasadnya, terangilah hatinya, tetapkanlah imannya, baikkanlah amalannya, luaskanlah rezekinya, dan jauhkanlah dari keburukan. Aamiin."</p>
            </div>
        </section>

        <!-- Section 3: The Family -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-6 text-amber-800">Kami yang Berbahagia</h2>
                <p class="text-lg">Keluarga Besar:</p>
                <p class="text-2xl font-bold mt-2">Bapak Rizky R. Harun</p>
                <p class="font-great-vibes text-4xl my-2">&</p>
                <p class="text-2xl font-bold">Ibu Inang Mopangga</p>
            </div>
        </section>

        <!-- Section 4: Event Details & Countdown -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-8 text-amber-800">Save The Date</h2>
                <div class="bg-amber-800 text-white p-6 rounded-xl inline-block shadow-lg">
                    <p class="text-2xl font-bold">Sabtu</p>
                    <p class="text-6xl font-bold border-y-2 border-white my-2 py-2">23</p>
                    <p class="text-2xl font-bold">Agustus 2025</p>
                </div>
                <div id="countdown" class="flex justify-center space-x-2 md:space-x-4 mt-8">
                    <div class="countdown-box"><span id="days" class="text-3xl font-bold">00</span><span class="text-xs">Hari</span></div>
                    <div class="countdown-box"><span id="hours" class="text-3xl font-bold">00</span><span class="text-xs">Jam</span></div>
                    <div class="countdown-box"><span id="minutes" class="text-3xl font-bold">00</span><span class="text-xs">Menit</span></div>
                    <div class="countdown-box"><span id="seconds" class="text-3xl font-bold">00</span><span class="text-xs">Detik</span></div>
                </div>
            </div>
        </section>

        <!-- Section 5: Location Details -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-6 text-amber-800">Lokasi Acara</h2>
                <p class="text-lg font-semibold">Kediaman Bapak Rizky R. Harun & Istri</p>
                <p class="mb-6">Komplek RO. Barakati</p>
                <!-- An embedded Google Map for easy navigation -->
                <div class="w-full h-60 rounded-xl overflow-hidden border-4 border-white shadow-lg my-4">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3988.498077583713!2d124.8422223152643!3d1.484857761406886!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x328774e50889987d%3A0x264d974a6218777!2sManado%2C%20Kota%20Manado%2C%20Sulawesi%20Utara!5e0!3m2!1sid!2sid!4v1661152912345!5m2!1sid!2sid" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
                <a href="https://maps.app.goo.gl/mYg2rPEiC3tGvYtKA" target="_blank" class="inline-block bg-amber-800 text-white px-8 py-3 rounded-full hover:bg-amber-900 transition duration-300 shadow-md">Buka di Google Maps</a>
            </div>
        </section>

        <!-- Section 6: Gift Information -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-6 text-amber-800">Kirim Hadiah</h2>
                <p class="mb-6">Doa restu Anda adalah hadiah terindah. Namun, jika ingin memberikan tanda kasih, Anda dapat melakukannya melalui:</p>
                <div class="space-y-4 text-left">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <p class="font-bold text-lg">Bank Mandiri</p>
                        <p class="text-sm">a.n. Rizky R. Harun</p>
                        <p id="bank-number" class="text-xl my-1">1234 5678 9012</p>
                        <button onclick="copyToClipboard('bank-number', this)" class="bg-amber-700 text-white text-sm px-4 py-1 rounded-md hover:bg-amber-800">Salin Nomor</button>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <p class="font-bold text-lg">GoPay / OVO / Dana</p>
                        <p class="text-sm">a.n. Inang Mopangga</p>
                        <p id="wallet-number" class="text-xl my-1">0812 3456 7890</p>
                        <button onclick="copyToClipboard('wallet-number', this)" class="bg-amber-700 text-white text-sm px-4 py-1 rounded-md hover:bg-amber-800">Salin Nomor</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: Closing Message -->
        <section class="section-wrapper">
            <div class="section-card">
                <h2 class="font-great-vibes text-5xl mb-6 text-amber-800">Terima Kasih</h2>
                <p>Atas kehadiran dan doa restu Bapak/Ibu/Saudara/i, kami ucapkan terima kasih.</p>
                <p class="text-sm mt-8">Digital Invitation by Arkan. Digi Desa Barakati.</p>
            </div>
        </section>

    </main>

    <!-- Audio element for music playback -->
    <audio id="background-music" loop></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const openButton = document.getElementById('open-button');
            const cover = document.getElementById('cover');
            const mainContent = document.getElementById('main-content');
            const sections = document.querySelectorAll('.section-wrapper');
            const musicBtn = document.getElementById('music-btn');
            const fontBtn = document.getElementById('font-btn');
            const linkGenBtn = document.getElementById('link-gen-btn');
            const bgBtn = document.getElementById('bg-btn');
            const fontMenu = document.getElementById('font-menu');
            const fontOptionsContainer = document.getElementById('font-options');
            const fontColorInput = document.getElementById('font-color');
            const childNameElement = document.getElementById('child-name');
            const audioPlayer = document.getElementById('background-music');
            const linkBox = document.getElementById('link-box');
            const closeLinkBoxBtn = document.getElementById('close-link-box');
            const guestNameInput = document.getElementById('guest-name-input');
            const generateLinkBtn = document.getElementById('generate-link-btn');
            const generatedLinkArea = document.getElementById('generated-link-area');
            const guestDisplayBox = document.getElementById('guest-display-box');
            const guestNameElement = document.getElementById('guest-name');
            const bgMenu = document.getElementById('bg-menu');
            const bgImageOptionsContainer = document.getElementById('bg-image-options');
            const bgSolidColorInput = document.getElementById('bg-solid-color');
            const bgGradColor1Input = document.getElementById('bg-grad-color1');
            const bgGradColor2Input = document.getElementById('bg-grad-color2');
            const applyBgGradientBtn = document.getElementById('apply-bg-gradient-btn');
            const apologyTextElement = document.getElementById('apology-text');
            const coverTitle = document.getElementById('cover-title');


            // Store current font and color settings
            let currentFont = 'Great Vibes';
            let currentColor = '#4a4a4a';

            // --- Function to determine text color based on background luminance ---
            function getLuminance(hexColor) {
                // Remove '#' and handle shorthand hex codes
                hexColor = hexColor.replace('#', '');
                if (hexColor.length === 3) {
                    hexColor = hexColor.split('').map(c => c + c).join('');
                }
                const r = parseInt(hexColor.substring(0, 2), 16);
                const g = parseInt(hexColor.substring(2, 4), 16);
                const b = parseInt(hexColor.substring(4, 6), 16);
                // Calculate luminance using a standard formula
                return (0.2126 * r + 0.7152 * g + 0.0722 * b);
            }

            // Function to update all text color on the cover page for better contrast
            function updateCoverTextColor() {
                const computedBg = window.getComputedStyle(cover).getPropertyValue('background-color');
                const computedGradient = window.getComputedStyle(cover).getPropertyValue('background-image');

                let luminance = 100; // Default luminance for image backgrounds
                let colorToApply;

                if (computedGradient.startsWith('linear-gradient')) {
                    // Handle gradient backgrounds
                    const colors = computedGradient.match(/rgb\((\d+), (\d+), (\d+)\)/g);
                    if (colors && colors.length === 2) {
                        const rgb1 = colors[0].match(/\d+/g).map(Number);
                        const rgb2 = colors[1].match(/\d+/g).map(Number);
                        const avgR = (rgb1[0] + rgb2[0]) / 2;
                        const avgG = (rgb1[1] + rgb2[1]) / 2;
                        const avgB = (rgb1[2] + rgb2[2]) / 2;
                        luminance = (0.2126 * avgR + 0.7152 * avgG + 0.0722 * avgB);
                    }
                } else if (computedBg.startsWith('rgb')) {
                    // Handle solid color backgrounds
                    const rgb = computedBg.match(/\d+/g).map(Number);
                    luminance = (0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2]);
                }
                
                // Determine whether to use black or white text based on luminance
                colorToApply = luminance > 128 ? '#4a4a4a' : '#ffffff';

                coverTitle.style.color = colorToApply;
                childNameElement.style.color = colorToApply;
                guestDisplayBox.style.color = colorToApply;
            }

            // --- URL Parameter Handling ---
            const urlParams = new URLSearchParams(window.location.search);
            const guestName = urlParams.get('to');
            const invitedFont = urlParams.get('font');
            const invitedColor = urlParams.get('color');

            // Check if there's a guest name in the URL
            if (guestName) {
                // Update the greeting element with the guest's name and show it
                guestNameElement.innerText = decodeURIComponent(guestName);
                guestDisplayBox.classList.remove('hidden');
                
                // Apply font and color from URL parameters, if available
                if (invitedFont) {
                    childNameElement.style.fontFamily = `'${invitedFont}', cursive`;
                    currentFont = invitedFont;
                }
                if (invitedColor) {
                    childNameElement.style.color = '#' + invitedColor;
                    currentColor = '#' + invitedColor;
                }
            }


            // --- Music Playlist and Player Logic ---
            const playlist = [
                'https://dn721908.ca.archive.org/0/items/man-ana_202211/MAN%20ANA.mp3',
                'https://files.catbox.moe/18l2h9.mp3',
                'https://files.catbox.moe/51rfqh.mp3',
                'https://ia902806.us.archive.org/28/items/SABYAN-DEENASSALAM/SABYAN%20-%20DEEN%20ASSALAM.mp3'
            ];
            let currentSongIndex = 0;
            let isMusicPlaying = false;

            // Set the default song as the source
            audioPlayer.src = playlist[currentSongIndex];

            // Function to toggle play/pause and update button icon
            const toggleMusic = () => {
                if (isMusicPlaying) {
                    audioPlayer.pause();
                    isMusicPlaying = false;
                    musicBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18V5l12-2v13"></path>
                            <circle cx="6" cy="18" r="3"></circle>
                            <circle cx="18" cy="16" r="3"></circle>
                        </svg>`;
                } else {
                    audioPlayer.play().catch(e => console.error("Playback failed:", e));
                    isMusicPlaying = true;
                    musicBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polygon points="10 8 16 12 10 16 10 8"></polygon>
                        </svg>`;
                }
            };
            
            // Event listener for the music button
            musicBtn.addEventListener('click', toggleMusic);

            // Play the next song when the current one ends
            audioPlayer.addEventListener('ended', () => {
                currentSongIndex = (currentSongIndex + 1) % playlist.length;
                audioPlayer.src = playlist[currentSongIndex];
                audioPlayer.play().catch(e => console.error("Playback failed:", e));
            });

            // --- Open Invitation Button Logic ---
            openButton.addEventListener('click', () => {
                // Fades out the cover page by setting its opacity to 0
                cover.style.opacity = '0';
                
                // After the fade-out transition, hide the cover and show the main content
                setTimeout(() => {
                    cover.style.display = 'none';
                    mainContent.classList.remove('hidden');
                    // Start playing music automatically when the invitation is opened
                    if (!isMusicPlaying) {
                        toggleMusic();
                    }
                }, 800); // Matches the 0.8s CSS transition duration
            });

            // --- Font Selector Logic ---
            const fontFamilies = [
                'Great Vibes', 'Poppins', 'Dancing Script', 'Lobster', 
                'Pacifico', 'Caveat', 'Satisfy', 'Courgette', 
                'Permanent Marker', 'Roboto Slab'
            ];

            // Toggle the font menu visibility
            fontBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevents the click from propagating to the document
                fontMenu.style.display = fontMenu.style.display === 'flex' ? 'none' : 'flex';
                linkBox.style.display = 'none'; // Hide other menus
                bgMenu.style.display = 'none';
            });
            
            // Close the font menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!fontMenu.contains(e.target) && e.target !== fontBtn) {
                    fontMenu.style.display = 'none';
                }
            });

            // Generate font buttons dynamically
            fontFamilies.forEach(font => {
                const button = document.createElement('button');
                button.textContent = font;
                button.classList.add('px-4', 'py-2', 'rounded-full', 'bg-white', 'hover:bg-gray-200', 'transition', 'duration-200', 'text-sm');
                button.style.fontFamily = `'${font}', sans-serif`;
                
                // Add click listener to change the font
                button.addEventListener('click', () => {
                    childNameElement.style.fontFamily = `'${font}', cursive`;
                    currentFont = font;
                    fontMenu.style.display = 'none'; // Hide menu after selection
                });
                fontOptionsContainer.appendChild(button);
            });

            // Event listener for color input change
            fontColorInput.addEventListener('input', (e) => {
                childNameElement.style.color = e.target.value;
                currentColor = e.target.value;
            });

            // --- Guest Link Generator Logic ---
            linkGenBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                fontMenu.style.display = 'none'; // Hide other menus
                bgMenu.style.display = 'none';
                linkBox.style.display = 'flex';
                generatedLinkArea.innerHTML = ''; // Clear previous link
                guestNameInput.value = ''; // Clear input field
            });

            closeLinkBoxBtn.addEventListener('click', () => {
                linkBox.style.display = 'none';
            });
            
            // Generate link when the button is clicked
            generateLinkBtn.addEventListener('click', () => {
                const name = guestNameInput.value.trim();
                if (name === "") {
                    // Show a message if the name is empty
                    generatedLinkArea.innerHTML = `<p class="text-red-500 text-sm">Nama tamu tidak boleh kosong.</p>`;
                    return;
                }

                // Construct the URL with parameters
                const params = new URLSearchParams();
                params.set('to', name);
                params.set('font', currentFont);
                params.set('color', currentColor.substring(1)); // Remove '#' for the URL

                const generatedLink = window.location.origin + window.location.pathname + '?' + params.toString();

                // Display the generated link with a copy button
                generatedLinkArea.innerHTML = `
                    <p class="text-sm font-semibold mb-2">Link Undangan Anda:</p>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="generated-link-input" value="${generatedLink}" readonly class="flex-grow px-2 py-1 border rounded-md text-sm">
                        <button id="copy-link-btn" class="bg-amber-700 text-white text-sm px-4 py-1 rounded-md hover:bg-amber-800">
                            Salin
                        </button>
                    </div>
                `;

                // Add event listener for the new copy button
                document.getElementById('copy-link-btn').addEventListener('click', () => {
                    copyToClipboard('generated-link-input', document.getElementById('copy-link-btn'));
                });
            });

            // --- Background Options Logic ---
            const recommendedImages = [
                'https://raw.githubusercontent.com/qisel/Digitalinvit/main/bg1.jpg',
                'https://raw.githubusercontent.com/qisel/Digitalinvit/main/bg2.jpg',
                'https://raw.githubusercontent.com/qisel/Digitalinvit/main/bg3.jpg',
                'https://raw.githubusercontent.com/qisel/Digitalinvit/main/bg4.jpg',
                'https://raw.githubusercontent.com/qisel/Digitalinvit/main/bg5.jpg'
            ];

            // Function to apply background image
            const applyBackgroundImage = (url) => {
                cover.style.background = `url('${url}') no-repeat center center`;
                cover.style.backgroundSize = 'cover';
                updateCoverTextColor();
            };

            // Set default background image
            applyBackgroundImage(recommendedImages[0]);

            // Generate image option buttons
            recommendedImages.forEach(url => {
                const btn = document.createElement('button');
                btn.classList.add('w-full', 'h-24', 'rounded-lg', 'overflow-hidden', 'border-2', 'border-transparent', 'hover:border-amber-500', 'transition-colors', 'duration-200');
                btn.style.backgroundImage = `url('${url}')`;
                btn.style.backgroundSize = 'cover';
                btn.style.backgroundPosition = 'center';
                btn.addEventListener('click', () => {
                    applyBackgroundImage(url);
                    bgMenu.style.display = 'none';
                });
                bgImageOptionsContainer.appendChild(btn);
            });

            bgBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                fontMenu.style.display = 'none';
                linkBox.style.display = 'none';
                bgMenu.style.display = bgMenu.style.display === 'flex' ? 'none' : 'flex';
            });
            
            document.addEventListener('click', (e) => {
                if (!bgMenu.contains(e.target) && e.target !== bgBtn) {
                    bgMenu.style.display = 'none';
                }
            });

            // Apply solid color background
            bgSolidColorInput.addEventListener('input', (e) => {
                const color = e.target.value;
                cover.style.background = color;
                cover.style.backgroundSize = 'cover';
                updateCoverTextColor();
            });

            // Apply gradient background
            applyBgGradientBtn.addEventListener('click', () => {
                const color1 = bgGradColor1Input.value;
                const color2 = bgGradColor2Input.value;
                const gradient = `linear-gradient(to bottom, ${color1}, ${color2})`;
                cover.style.background = gradient;
                bgMenu.style.display = 'none';
                updateCoverTextColor();
            });


            // --- Intersection Observer for Fade-in Effect on Scroll ---
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, {
                root: mainContent,
                threshold: 0.5
            });

            sections.forEach(section => {
                observer.observe(section);
            });

            // --- Countdown Timer Script ---
            const countdownDate = new Date("Aug 23, 2025 09:00:00").getTime();
            const countdownFunction = setInterval(() => {
                const now = new Date().getTime();
                const distance = countdownDate - now;

                if (distance < 0) {
                    clearInterval(countdownFunction);
                    document.getElementById("countdown").innerHTML = "<div class='text-center w-full text-xl font-bold'>Acara Telah Berlangsung!</div>";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById("days").innerText = days.toString().padStart(2, '0');
                document.getElementById("hours").innerText = hours.toString().padStart(2, '0');
                document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
                document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
            }, 1000);

            // --- Copy to Clipboard Script ---
            function copyToClipboard(elementId, button) {
                const textToCopy = document.getElementById(elementId).value;
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();

                try {
                    document.execCommand('copy');
                    button.innerText = 'Tersalin!';
                    setTimeout(() => { button.innerText = 'Salin'; }, 2000);
                } catch (err) {
                    console.error('Gagal menyalin teks: ', err);
                }
                document.body.removeChild(tempTextArea);
            }
        });
    </script>
</body>
</html>
